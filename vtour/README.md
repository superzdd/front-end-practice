# 全景制作工具krpano的经验总结
krpano

## 代码介绍

这份代码里主要记录了再krpano的使用场景里，一些可能会用到的效果。
### 伪横屏
先解释一下伪横屏和真横屏的差别，这个很重要。手机H5的横屏几乎都是伪横屏，那为什么不做真横屏呢？有以下几点原因：
1. 用户的手机往往会设置方向锁定（包括微信中的横屏锁定），导致即使手机已经横过来了，但是页面并没有横过来.
2. 即使页面能跟着屏幕横过来，但是页面标题的白色方块会占据整个屏幕的上半区域，标题面积比竖屏时大很多，那反过来实际用于显示页面的面积就变小了，因为手机屏幕大小是固定的。而且实际页面会很扁，不好做适配，而且随着现在手机屏幕越来越长，横屏就会越来越扁，适配就会越来越难做。如果一个项目横竖屏状态下都要做适配，耗时会很久，何况横屏下效果也不好。
3. 99%的用户手机都是竖过来用的，所以页面默认都是竖屏显示的。那假设我们的页面确实是要在真横屏下才能使用的，那就要先做一页提示页，提示用户旋转手机。那伪横屏情况下就不需要了吗？需要也是需要的（比如提醒用户锁定屏幕之类的）。但是，虽然看起来都是要做一个提示页面的，但其中有区别：真横屏的提示页面要根据竖版手机适配，跟其他页面的适配逻辑是完全不同的，但伪横屏就不会有这个问题。
4. 伪横屏有一个优势，就是页面打开之后，直接就能显示横过来的页面，用户一看到页面是横过来的，也能了解到需要把手机横过来使用。而真横屏的页面，这点是做不到的，不把手机横过来之前，是看不到横屏页面长什么样的，而且前面的提示页也是必不可少的。
综上所述，伪横屏在手机H5上的体验更好一些。

krpano在做伪横屏时，其实只要设置视角`camroll="90"`就可以了，东西非常简单，但就是需要非常仔细的看文档，否则找不到这个属性，也是很难实现的。
```
<scene name="scene_a1" title="场景1-伪横屏" onstart="" thumburl="panos/a2.tiles/thumb.jpg" lat="" lng="" heading="">
	<view hlookat="-64.736" vlookat="0.170" fovtype="MFOV" fov="120.000" maxpixelzoom="2.0" fovmin="70" fovmax="140" limitview="auto" camroll="90" />

	<preview url="panos/a2.tiles/preview.jpg" />

	<image>
		<cube url="panos/a2.tiles/pano_%s.jpg" />
	</image>
</scene>
```

**注意** 切换场景的时候，camroll是会被带到下个场景里去的。如果下个场景不是伪横屏场景了，记得把camroll调整回0 

### 放大局部
放大局部就是将照相机更凑近物体，调小`fov`
```
<action name="zoomtest">
	copy(current_fov, view.fov);
	tween(view.fov,0,2);
</action>
```

### 切换场景同时视角保持不变，可以制作一些类似于开灯，关灯的场景
这里需要预先设置好两个一模一样的场景，包括场景里的其他热点都要一模一样，否则会穿帮，其次就是跳转是保持视角了，用一个`KEEPVIEW`属性来解决问题
```
<action name="gotoFour">
	loadscene(scene_a4,null,MERGE|KEEPVIEW,BLEND(0.5));
</action>
```

## 重要参考网站备份
[tour.xml文件解析](http://www.krpano360.com/xunxujianjin11-tour-xmldejingtaidaimadouyoushenmezuoyong/)
> 非常实用的文档，里面包含了krpano的常见配置的中文释义，可以当做一个目录索引使用。比如现在这个文章里找关键词，找到了再去官方文档中找有没有属性匹配。
[官方xml文档](https://krpano.com/docu/xml)
> 官方文档，全英文，阅读起来很有难度。记得看属性的时候，一定要点`show advance settings`，以免错过关键属性。


## 其他经验
- tour.xml是krpano的主入口, 其有一个重要功能是：关联了项目中所有的xml文件。比如：
``` xml
<include url="skin/vtourskin.xml" />
```

- 官方名词：球形全景图，长宽比是2:1。

- tour.xml这个名字最好不要改，因为krpano的官方编辑工具的入口也是tour.xml，所以文件名最好不要动，使用起来才比较直观。